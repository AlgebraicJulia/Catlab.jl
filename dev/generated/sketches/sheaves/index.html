<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Sheaf Constructions · Catlab.jl</title><meta name="title" content="Basic Sheaf Constructions · Catlab.jl"/><meta property="og:title" content="Basic Sheaf Constructions · Catlab.jl"/><meta property="twitter:title" content="Basic Sheaf Constructions · Catlab.jl"/><meta name="description" content="Documentation for Catlab.jl."/><meta property="og:description" content="Documentation for Catlab.jl."/><meta property="twitter:description" content="Documentation for Catlab.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><script src="../../../assets/analytics.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.svg" alt="Catlab.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Catlab.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Catlab.jl</a></li><li><span class="tocitem">Vignettes</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox" checked/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Seven Sketches in Compositionality</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../partitions/">Partitions</a></li><li><a class="tocitem" href="../preorders/">Preorders</a></li><li><a class="tocitem" href="../meets/">Meets in Preorders</a></li><li><a class="tocitem" href="../smc/">Symmetric Monoidal Categories</a></li><li><a class="tocitem" href="../cat_elements/">The Category of Elements</a></li><li class="is-active"><a class="tocitem" href>Basic Sheaf Constructions</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Graphs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../graphs/graphs/">The Category of Graphs</a></li><li><a class="tocitem" href="../../graphs/graphs_label/">Labeled Graphs</a></li><li><a class="tocitem" href="../../graphs/subgraphs/">Algebra of subgraphs</a></li></ul></li><li><span class="tocitem">Categorical Algebra</span></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox"/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">Wiring Diagrams</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../wiring_diagrams/wiring_diagram_basics/">Basics of wiring diagrams</a></li><li><a class="tocitem" href="../../wiring_diagrams/diagrams_and_expressions/">Wiring diagrams and syntactic expressions</a></li><li><a class="tocitem" href="../../wiring_diagrams/wd_cset/">Wiring Diagrams as Attributed C-Sets</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-5" type="checkbox"/><label class="tocitem" for="menuitem-2-5"><span class="docs-label">Graphics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../graphics/graphviz_graphs/">Drawing graphs in Graphviz</a></li><li><a class="tocitem" href="../../graphics/graphviz_wiring_diagrams/">Drawing wiring diagrams in Graphviz</a></li><li><a class="tocitem" href="../../graphics/composejl_wiring_diagrams/">Drawing wiring diagrams in Compose.jl</a></li><li><a class="tocitem" href="../../graphics/tikz_wiring_diagrams/">Drawing wiring diagrams in TikZ</a></li><li><a class="tocitem" href="../../graphics/layouts_vs_drawings/">Layouts versus drawings of wiring diagrams</a></li></ul></li></ul></li><li><span class="tocitem">Modules</span><ul><li><a class="tocitem" href="../../../apis/theories/">Standard library of theories</a></li><li><a class="tocitem" href="../../../apis/categorical_algebra/">Categorical algebra</a></li><li><a class="tocitem" href="../../../apis/graphs/">Graphs</a></li><li><a class="tocitem" href="../../../apis/wiring_diagrams/">Wiring diagrams</a></li><li><a class="tocitem" href="../../../apis/graphics/">Graphics</a></li><li><a class="tocitem" href="../../../apis/programs/">Programs</a></li><li><a class="tocitem" href="../../../apis/sheaves/">Sheaves</a></li></ul></li><li><span class="tocitem">Developer Docs</span><ul><li><a class="tocitem" href="../../../devdocs/release/">Release Notes</a></li><li><a class="tocitem" href="../../../devdocs/style/">Style Guide for AlgebraicJulia</a></li><li><a class="tocitem" href="../../peg-parser/dsl_peg_tutorial/">Domain Specific Parsing Expression Grammars</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Vignettes</a></li><li><a class="is-disabled">Seven Sketches in Compositionality</a></li><li class="is-active"><a href>Basic Sheaf Constructions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic Sheaf Constructions</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/Catlab.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/AlgebraicJulia/Catlab.jl/blob/main/docs/literate/sketches/sheaves.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-Sheaf-Constructions"><a class="docs-heading-anchor" href="#Basic-Sheaf-Constructions">Basic Sheaf Constructions</a><a id="Basic-Sheaf-Constructions-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Sheaf-Constructions" title="Permalink"></a></h1><p>This example shows how to use a sheaf Catlab. We use the DiagramTopology on FinSet and the Free Vector Space functor to illustrate this process.</p><pre><code class="language-julia hljs">using Test
using Catlab.CategoricalAlgebra, Catlab.BasicSets
using Catlab.CategoricalAlgebra.Categories
using Catlab.Sheaves
using Catlab.CategoricalAlgebra.Misc.Matrices: MatrixDom
import Catlab.Sheaves: pullback_matrix, FinSetCat</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">WARNING: Imported binding Matrices.MatrixDom was undeclared at import time during import to Main.</code></pre><p>The Topology that we are using is the <code>DiagramTopology</code>, which says that a cover of an object <code>c</code> is any diagram with <code>c</code> as its colimit. The cocone of the diagram gives you a basis for the sieve that covers <code>c</code>. The legs of the cocone can be interpreted as open subsets of <code>c</code> whose union is <code>c</code>. Because colimits are functorial and the base category is adhesive, the diagram topology is well defined.</p><p>We have two different implementations of equivalent sheaves. The <code>VectSheaf</code> implementation uses julia functions and the <code>VectSheafMat</code> implementation uses sparse matrices.</p><pre><code class="language-julia hljs">VectSheaf = Sheaf(DiagramTopology(), FVectPullback)
VectSheafMat = Sheaf(DiagramTopology(), FMatPullback)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Sheaf{DiagramTopology, Functor{FinSetInt, Int64, FinFunction, AbstractMatrix{Number}}}(DiagramTopology(), FunctorCallable{FinSetInt, Int64, FinFunction, AbstractMatrix{Number}}(Catlab.Sheaves.var&quot;#36#37&quot;(), Catlab.Sheaves.var&quot;#38#39&quot;(), SkelFinSet(), Catlab.CategoricalAlgebra.Misc.Matrices.MatC{Number}()))</code></pre><p>We want to introduce a cover of the set <span>${1...4}$</span> with two open sets <span>${1,2,3}$</span> and <span>${1,2,4}$</span>. To do that, we will construct a pushout.</p><pre><code class="language-julia hljs">f = FinFunction([1,2], 3)
g = FinFunction([1,2], 3)
S = ColimCover(pushout[SkelFinSet()](f,g))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ColimCover(FinSet(4)):
  compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(1:3, FinSet(6))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([1, 2, 3, 1, 2, 4], FinSet(4))))
  compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(4:6, FinSet(6))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([1, 2, 3, 1, 2, 4], FinSet(4))))</code></pre><p>The main API of a sheaf is that you can:</p><ol><li>restrict sections along a morphism,</li><li>check if a collection of local sections match on the overlaps,</li><li>and extend a collection of local sections if they match.</li></ol><p>We can restrict a global section along the first leg</p><pre><code class="language-julia hljs">v = [1,2,3,4]
v₁ = restrict(VectSheaf, v, legs(S)[1])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Int64}:
 1
 2
 3</code></pre><p>Or the second leg.</p><pre><code class="language-julia hljs">v₂ = restrict(VectSheaf, v, legs(S)[2])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">3-element Vector{Int64}:
 1
 2
 4</code></pre><p>Notice that we got two different values, but that the first two entries of those restricted vectors agree. That is because our two legs have an overlap in the first two dimensions. If we restrict again by the arrows in our diagram (f,g) we should get the same answer.</p><pre><code class="language-julia hljs">restrict(VectSheaf, v₁, f)  == restrict(VectSheaf, v₂, g)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>A sheaf requires:</p><ul><li>a notion of dividing up a space into pieces (the open coverage),</li><li>a way of measuring data over the pieces (the set of sections given by the functor on objects), along with</li><li>ways of relating measurements on a piece to measurements on a subpiece (the restriction maps given by the functor).</li></ul><p>Functoriality of the the sheaf tells you that restricting the same data along commuting paths will always give you the same data on the common piece.</p><p>The sheaf condition requires that you can compute an extension of local data to global data. There is no way to derive this operation from the contravariant functor of the sheaf so providing it is part of the API in defining a new sheaf.</p><pre><code class="language-julia hljs">extend(VectSheaf, S, [[1.0, 2,3], [1,2.0,6]])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">4-element Vector{Float64}:
 1.0
 2.0
 3.0
 6.0</code></pre><p>If the local sections don&#39;t match, then extending will fail.</p><pre><code class="language-julia hljs">@test_throws MatchingError extend(VectSheaf, S, [[1.0, 2,3], [1,3.0,6]])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span>
      Thrown: MatchingError{MatchingFailure}</code></pre><p>extend(VectSheaf, S, [[1.0, 2,3], [1,3.0,6]])</p><p>Pushouts are the covers with only two subobjects, but the sheaf works on diagrams of any size.</p><pre><code class="language-julia hljs">D = FreeDiagram(FreeGraph(FinSet.([3,2,3,3]), # list of objects
 [ # list of (hom, src, tgt) tuples
  (FinFunction([1,2], 3), 2,1),
  (FinFunction([1,2], 3), 2,3),
  (FinFunction([1,2], 3), 2,4)
  ]
))

K = ColimCover(D)

section_data = [Float64[1,2,3],
   Float64[1,2],
   Float64[1,2,5],
   Float64[1,2,6]]

v = extend(VectSheaf, K, section_data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 3.0
 1.0
 2.0
 5.0
 6.0</code></pre><p>Our two sheaves should agree, because they are just two different implementations of the same sheaf.</p><pre><code class="language-julia hljs">global_section = extend(VectSheafMat, K, section_data)
v == global_section</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">false</code></pre><p>If you put in bad data, you get MatchingErrors</p><pre><code class="language-julia hljs">section_data_bad = [Float64[1,2,3],
   Float64[1,2],
   Float64[1,3,5],
   Float64[1,3,6]]

@test_throws MatchingError extend(VectSheaf, K, section_data_bad)
@test_throws MatchingError extend(VectSheafMat, K, section_data_bad)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi"><span class="sgr32"><span class="sgr1">Test Passed</span></span>
      Thrown: MatchingError{MatchingFailure}</code></pre><p>if we disable the checks, VectSheafMat will solve a least squares problem instead of last write wins.</p><pre><code class="language-julia hljs">extend(VectSheafMat, K, section_data_bad, check=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 3.0
 0.9999999999999998
 2.4999999999999996
 5.0
 6.0</code></pre><p>Last write wins definition is different.</p><pre><code class="language-julia hljs">extend(VectSheaf, K, section_data_bad, check=false)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">5-element Vector{Float64}:
 3.0
 1.0
 3.0
 5.0
 6.0</code></pre><p>You can diagnose a matching error from the exception that extend throws.</p><pre><code class="language-julia hljs">try
  extend(VectSheaf, K, section_data_bad)
catch e
  e
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MatchingError: Sections don&#39;t match on 4 overlaps:
MatchingFailure: Sections don&#39;t match on:
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(1:3, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5)))) and
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(6:8, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5))))
	[1.0, 2.0] ◁ [1.0, 2.0, 3.0] but
	[1.0, 3.0] ◁ [1.0, 3.0, 5.0]
MatchingFailure: Sections don&#39;t match on:
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(1:3, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5)))) and
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(9:11, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5))))
	[1.0, 2.0] ◁ [1.0, 2.0, 3.0] but
	[1.0, 3.0] ◁ [1.0, 3.0, 6.0]
MatchingFailure: Sections don&#39;t match on:
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(4:5, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5)))) and
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(6:8, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5))))
	[1.0, 2.0] ◁ [1.0, 2.0] but
	[1.0, 3.0] ◁ [1.0, 3.0, 5.0]
MatchingFailure: Sections don&#39;t match on:
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(4:5, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5)))) and
	compose(WithModel{FinFunctionVector{FinSet, Int64, UnitRange{Int64}}}(FinFunction(9:11, FinSet(11))), WithModel{FinFunctionVector{FinSet, Int64, Vector{Int64}}}(FinFunction([2, 3, 1, 2, 3, 2, 3, 4, 2, 3, 5], FinSet(5))))
	[1.0, 2.0] ◁ [1.0, 2.0] but
	[1.0, 3.0] ◁ [1.0, 3.0, 6.0]
</code></pre><p>This concludes our discussion of the sheaf API.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cat_elements/">« The Category of Elements</a><a class="docs-footer-nextpage" href="../../graphs/graphs/">The Category of Graphs »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Wednesday 15 October 2025 07:00">Wednesday 15 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
